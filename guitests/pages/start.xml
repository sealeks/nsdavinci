<?xml-stylesheet href="../util/libscript.xsl" type="text/xsl"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 576 324" enable-background="new 0 0 576 324" xml:space="preserve" xmlns:xml="http://www.w3.org/XML/1998/namespace" onload="init_project_controller()"><script type="text/javascript" xlink:href="../util/js/libutil.js"/><script type="text/javascript" xlink:href="../util/js/designer.js"/><script type="text/javascript" xlink:href="simulator.js"/>
    <script type="text/javascript" xlink:href="../util/js/libutil.js"/>
    <script type="text/javascript" xlink:href="../util/js/designer.js"/>

<script type="text/javascript" xlink:href="../util/js/designer.js"/> 
<script type="text/javascript" xlink:href="../util/js/libutil.js"/> 
<script type="text/javascript" id="stopscript"><![CDATA[
function ___global___unload(){
if (window.simTick) clearInterval(window.simTick);
if (window.simulation_detach) simulation_detach();
   
//alert('Stop');


};
]]></script>
<script type="text/javascript" id="startscript"><![CDATA[
if ((window.$$editable)&&(!window.$$editable())){
//alert('startscript: ' + window.document.URL);
simproccessor  = [];






SIMULATIONTICK = 100;

function add_simulation(sim){ 
       simproccessor.push(sim);
       
}

function  simulation_execute(){
  for (var i=0; i < simproccessor.length; ++i){
      simproccessor[i].execute();
  }
}

function simulation_detach(){
  for (var i=0; i < simproccessor.length; ++i){
      simproccessor[i].detach();
  }
}





window.simTick = setInterval(simulation_execute, SIMULATIONTICK );




////////////////////////////////////////////////////////////////////////////////////////////////////////

add_simulation ( new simulator.initializer('in_pos' , 50 , 50));
add_simulation ( new simulator.initializer('in_sp' , 50 , 50));
add_simulation ( new simulator.initializer('auto' , 1 , 0));

add_simulation ( new simulator.initializer('out_pos' , 50 , 50));
add_simulation ( new simulator.initializer('out_sp' , 50 , 50));
add_simulation ( new simulator.initializer('level' , 50 , 50));
add_simulation ( new simulator.initializer('level0' , 50 , 50));
add_simulation ( new simulator.initializer('level_sp' , 50 , 50));

add_simulation ( new simulator.initializer('v1on' , 0 , 0));
add_simulation ( new simulator.initializer('v1off' , 1 , 0));
add_simulation ( new simulator.initializer('rv1on' , 0 , 0));
add_simulation ( new simulator.initializer('rv1off' , 0 , 0));
add_simulation ( new simulator.initializer('dv1on' , 0 , 0));
add_simulation ( new simulator.initializer('dv1off' , 0 , 0));

add_simulation ( new simulator.valueobserver('level' , null , 'level + (in_pos-out_pos)/10000 * level.maxeu' ,null));

add_simulation ( new simulator.actuator('in_pos' , 'in_sp', 0.3));

add_simulation (new simulator.regulator('level', 'level_sp', 'out_pos' , 'out_sp', 'auto' , true, 'level_p', 'level_i', 'level_d', 0.3 ));

// Котел


add_simulation ( new simulator.initializer('f' , 0 , 0));
add_simulation ( new simulator.initializer('pg' , 90 , 0));
add_simulation ( new simulator.initializer('pg0' , 0 , 0));
add_simulation ( new simulator.initializer('p1' , 0 , 0));

add_simulation ( new simulator.initializer('pg0_pos' , 0 , 0));
add_simulation ( new simulator.initializer('pg0_sp' , 0 , 0));
add_simulation ( new simulator.initializer('prz_pos' , 0 , 0));
add_simulation ( new simulator.initializer('prz_sp' , 0 , 0));
add_simulation ( new simulator.initializer('pg0_auto' , 1 , 0));
add_simulation ( new simulator.differeciator('pg0' , null , 'gz_off ? 80: pg*(prz_pos/100)' ,null));
add_simulation ( new simulator.differeciator('p1' , null , '(pzk1_2_off || pzk1_1_off ) ? 0 : (pg0*(prz1_pos/100))' ,null));
add_simulation (new simulator.regulator('pg0', 'pg0_sp', 'prz_pos' , 'prz_sp', 'pg0_auto' , false, 'pg0_kp', 'pg0_ki', 'pg0_kd', 1 ));

add_simulation ( new simulator.initializer('prz1_pos' , 0 , 0));
add_simulation ( new simulator.initializer('prz1_sp' , 0 , 0));
add_simulation ( new simulator.actuator('prz1_pos' , 'prz1_sp',1));


var gz = simulator.valve_init(2,'gz_on', 'gz_off' , 'gz_don', 'gz_doff', 'gz_ron', 'gz_roff', 10000, 10000 );

// Газовый тракт


 var gazblock = function(pref){
   add_simulation ( new simulator.initializer('mopress1' , 0 , 0));
   add_simulation ( new simulator.initializer('ropress1' , 0 , 0));
   add_simulation ( new simulator.initializer('mrozz1' , 0 , 0));
   add_simulation ( new simulator.initializer('rrozz1' , 0 , 0));   
   add_simulation ( new simulator.initializer('mwork1' , 0 , 0));
   add_simulation ( new simulator.initializer('rstop1' , 0 , 0));
   add_simulation ( new simulator.initializer('mstop1' , 0 , 0));
   
   add_simulation ( new simulator.initializer('p1_control' , 0 , 0));


   var pzk1_1 = simulator.valve_init(2,'pzk1_1_on', 'pzk1_1_off' , 'pzk1_1_don', null, 'pzk1_1_ron', null , 10000, 0 , 'pzk1_1_auto');
   var pzk1_2 = simulator.valve_init(2,'pzk1_2_on', 'pzk1_2_off' , 'pzk1_2_don', null, 'pzk1_2_ron', null , 10000, 0 , 'pzk1_2_auto');
   var ko1 = simulator.valve_init(2,'ko1_on', null , null, null, 'ko1_ron', null , 100, 100 , 'ko1_auto' );
   var kz1 = simulator.valve_init(2,'kz1_on', null , null, null, 'kz1_ron', null , 100, 100 , 'kz1_auto' );
   var kb1 = simulator.valve_init(1,null, 'kb1_off' , null , null , null , 'kb1_roff' , 100, 100,  'kb1_auto'  );

   add_simulation (new simulator.booldelayer('pg1_min' ,0 , 'ko1_on && !gz_off' ,0, 1,0, 3000,0));
   add_simulation (new simulator.booldelayer('pg1_max' ,0 , 'ko1_on && !gz_off' ,0, 1,0, 6000,0));
   add_simulation (new simulator.booldelayer('pg1_min' ,null , '!pzk1_1_off && !gz_off' ,null, 1, 0, 0 ,0));
   add_simulation (new simulator.booldelayer('pg1_max' ,null , '!pzk1_1_off && !gz_off' ,null, 1, 0, 0 ,0));  
   
   add_simulation (new simulator.booldelayer('flame1' ,0 , '!pzk1_1_off && !pzk1_2_off && !gz_off' ,0, 1,0, 5000,0));
   add_simulation (new simulator.booldelayer('flame1z' ,0 , '!pzk1_1_off && kz1_on && !gz_off' ,0, 1,0, 5000,0));
   
   var opress1 = new simulator.sheduler(0,'ropress1',0,[  {sp: 1, shedule: new simulator.sheduler.commandshedule(function(){$$('mopress1 @ 1');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('ropress1 @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('pg0_auto @ 1,pg0_sp @ 20');})},
                                                          {sp: 0, shedule: new simulator.sheduler.checkvalueshedule('abs(pg0-20)<2')},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('pzk1_1_auto @ 1,pzk1_2_auto @ 1,ko1_auto @ 1,kb1_auto @ 1,kz1_auto @ 1');})},
                                                             
                                                          {sp: 0, shedule: kb1},
                                                          {sp: 1, shedule: ko1},
                                                          {sp: 0, shedule: new simulator.sheduler.timeoutshedule(1000)},
                                                          {sp: 0, shedule: ko1},
                                                          {sp: 1, shedule: pzk1_1},
                                                          {sp: 0, shedule: new simulator.sheduler.timeoutshedule(4000)},
                                                          {sp: 0, shedule: pzk1_1}]);
                                                          
   add_simulation (opress1);                                                       
   
   var rozz1 = new simulator.sheduler(0,'rrozz1',0,[      {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('rrozz1 @ 0');})},                                                      
                                                          {sp: 0, shedule: opress1},
                                                          {sp: 1, shedule: new simulator.sheduler.commandshedule(function(){$$('mopress1 @ 0');})},
                                                          {sp: 1, shedule: new simulator.sheduler.commandshedule(function(){$$('mrozz1 @ 1');})},
                                                          {sp: 1, shedule: pzk1_1},{sp: 1, shedule: kz1},
                                                          {sp: 0, shedule: new simulator.sheduler.timeoutshedule(6000)},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('prz1_sp @ 20');})},
                                                          {sp: 0, shedule: new simulator.sheduler.checkvalueshedule('abs(prz1_pos-20)<3')},
                                                          {sp: 1, shedule: pzk1_2},
                                                          {sp: 0, shedule: kz1},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('prz1_sp @ 100');})},
                                                          {sp: 0, shedule: new simulator.sheduler.checkvalueshedule('abs(prz1_pos-100)<3')},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('mwork1 @ 1');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('p1_control @ 1');})}
                                                          ]);
                                                          
    add_simulation (rozz1); 
    
    var stop1 = new simulator.sheduler(0,'rstop1',0,[     {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('mstop1 @ 1');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('rstop1 @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('p1_control @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('mopress1 @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('mwork1 @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule(function(){$$('mrozz1 @ 0');})},
                                                          {sp: 0, shedule: pzk1_2},
                                                          {sp: 0, shedule: pzk1_1},                                                         
                                                          {sp: 1, shedule: kb1},
                                                          {sp: 0, shedule: new simulator.sheduler.timeoutshedule(4000)},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('prz1_sp @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.checkvalueshedule('abs(prz1_pos-0)<3')},
                                                          {sp: 0, shedule: kb1},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('mstop1 @ 0');})},
                                                          {sp: 0, shedule: new simulator.sheduler.commandshedule( function(){$$('pzk1_1_auto @ 0,pzk1_2_auto @ 0,ko1_auto @ 0,kb1_auto @ 0,kz1_auto @ 0');})}]);
                                                          
     add_simulation (stop1); 
    
    }
    
    gazblock();
                                                          
                                                         

};
]]></script>
<project path="file:///F:/Project/davinci/guitests/pages/">

  
  <form name="guimotor3" file="guimotor3.xml" caption="Газ" left="0%" top="0%" width="85%" height="85%" decorated="no" visible="false"/>
  <form name="testopen" file="testopen.xml" caption="Мазут" left="85%" top="0%" width="15%" height="100%" decorated="no"/>
  
  <form name="falarm" file="falarm.xml" left="0%" top="85%" width="85%" height="15%" caption="fa" decorated="no" visible="true"/>
  <form name="test" file="test.xml" left="0%" top="00%" width="85%" height="85%" caption="test" decorated="no"/>
  <form name="gazblock" file="gazblock.xml" left="0%" top="0%" width="85%" height="85%" caption="gazblock" decorated="no"/>
  <!--form name="tes" file="atest.xml" left="0%" top="00%" width="85%" height="85%" caption="te" decorated="no"/-->
  
  <scriptfile name="script1" file="script1.js"/>

  <lib xsd="../libs/main/mainlib.xsd" name="mainlib" caption="Базовая библиотека компонентов"/>
  <lib xsd="../libs/svg/svg.xsd" name="svglib" caption="SVG"/>
</project>

</svg>